

# 댓글 기능 구현 - DAO와 Service의 작성

## 댓글 기능 구현 순서
  1. DB테이블 생성
  2. MapperXML작성
  3. DAO 작성 & 테스트
  4. Service 작성 & 테스트
  5. 컨트롤러 작성 & 테스트
  6. 뷰(UI) 작성 & 테스트

```
  ※ DB → MyBatis → @Repository → @Service → @Controller -> View
```




## Service
  * @Autowired를 주입하지 않고 생성자를 사용할 경우, @Repository로 등록되지 않은 Class를 알 수 있다.

~~~JAVA
@Service
public class CommentServiceImpl implements CommentService {
//    @Autowired
    BoardDao boardDao;
//    @Autowired
    CommentDao commentDao;

    public CommentServiceImpl(CommentDao commentDao, BoardDao boardDao) {
        this.commentDao = commentDao;
        this.boardDao = boardDao;
    }
// ...
~~~




## Controller
~~~JAVA
@Controller
public class CommentController {
    @Autowired
    CommentService service;

    // 지정된 댓글을 삭제하는 메서드
    @DeleteMapping("/comments/{cno}")   // /comments/1?bno=1085 <- 삭제할 댓글 번호
    @ResponseBody public ResponseEntity<String> remove(@PathVariable Integer cno, Integer bno,  HttpSession session) {
    /* Integer cno는 쿼리스트링이 아닌 URL의 일부이기 때문에 @PathVariable 애너테이션을 붙이고
       URL의 주소에는 괄호({cno})로 감싸준다. */
        String commenter = (String) session.getAttribute("id");
        try {
            int rowCnt = service.remove(cno, bno, commenter);
            if(rowCnt != 1)
                throw new Exception("Delete Failed");
            return new ResponseEntity<>("DEL_OK",HttpStatus.OK);
        } catch (Exception e) {
            e.printStackTrace();
            return new ResponseEntity<>("DEL_ERR",HttpStatus.BAD_REQUEST);
        }
    }


    // 지정된 게시물의 모든 댓글을 가져오는 메서드
    @GetMapping("/comments")        // comments?bno=1080 GET
    @ResponseBody public ResponseEntity<List<CommentDto>> list(Integer bno) {
        List<CommentDto> list = null;
        try {
            list = service.getList(bno);
            /* 
               ResponseEntity<List<CommentDto>>(list, HttpStatus.OK);
               : 상태코드를 함께 담아서 보낸다.
             */
            return new ResponseEntity<List<CommentDto>>(list, HttpStatus.OK); // 200
        } catch (Exception e) {
            e.printStackTrace();
            // Error 발생 시에도 200번대 상태코드가 발생하는 것을 수정해줌.
            return new ResponseEntity<List<CommentDto>>(HttpStatus.BAD_REQUEST); // 400
        }
    }
}
~~~
