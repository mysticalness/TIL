
# 서비스 계층의 분리와 @Transactional(1)

## 서비스 계층(Layer)의 분리 - 비즈니스 로직의 분리
  * Tx를 적용하기에는 서비스 계층이 적합하다.
  * Presentation Layer = @Controller
Service Layer = @Service
Persistence Layer = @Repository
    * @Controller, @Service, @Repository모두 @Component를 포함하고 있기 때문에 \<component-scan>태그로 자동 스캔이 된다.

<a href='https://ifh.cc/v-p687WP' target='_blank'><img src='https://ifh.cc/g/p687WP.png' border='0'></a>

<a href='https://ifh.cc/v-OStNcG' target='_blank'><img src='https://ifh.cc/g/OStNcG.png' border='0'></a>

<a href='https://ifh.cc/v-NKOl1b' target='_blank'><img src='https://ifh.cc/g/NKOl1b.png' border='0'></a>


## TransactionManager란?
  * DAO의 각 메서드는 개별 Connection을 사용
    * Tx은 1개의 Connection에서 이루어진다.
      * deleteUser(); 메서드를 두 번 호출 시에 두 개의 커넥션의 생긴다. 때문에, Rollback 불가. 개별 커넥션을 하나의 같은 Connection으로 사용해야 예외가 발생했을 때, Rollback이 가능하다. = TransactionManager의 역할.

<a href='https://ifh.cc/v-w7LQbn' target='_blank'><img src='https://ifh.cc/g/w7LQbn.png' border='0'></a>

  * 같은 Tx내에서 같은 Connection을 사용할 수 있게 관리

<a href='https://ifh.cc/v-1xaHON' target='_blank'><img src='https://ifh.cc/g/1xaHON.png' border='0'></a>

  * DAO에서Connection을얻거나 반환할 때 DataSourceUtils를 사용해야

<a href='https://ifh.cc/v-4c9TTF' target='_blank'><img src='https://ifh.cc/g/4c9TTF.png' border='0'></a>

## TransactionManager로 Transaction 적용하기

<a href='https://ifh.cc/v-V2Dh4l' target='_blank'><img src='https://ifh.cc/g/V2Dh4l.jpg' border='0'></a>

## @Transactional로 Transaction 적용하기

  * AOP를 이용한 핵심 기능과 부가 기능의 분리
    * AOP : 자동으로 코드를 추가해주는 기능
  * @Transactional은 클래스나 인터페이스에도 붙일 수 있음

<a href='https://ifh.cc/v-ptp2zf' target='_blank'><img src='https://ifh.cc/g/ptp2zf.jpg' border='0'></a>

<br>






